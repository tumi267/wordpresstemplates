document.addEventListener("DOMContentLoaded",(async function(){let e=1,t=!1,n=!0,r=null,o=null,a=null,i=null,l=new Set;const c=document.getElementById("infinite-scroll-attributes"),s=c.getAttribute("data-font-family"),d=c.getAttribute("data-text-color"),u=c.getAttribute("data-rgba-background-color");function f(e){const t=document.getElementById("loading-indicator");t&&(t.style.display=e?"block":"none")}function m(){const e=document.getElementById("sentinel");e&&(e.innerHTML=n?"":"<div class='no-more-posts'>No more posts.</div>")}function g(){o=null,a=null,i=null,document.querySelectorAll("#year-filter li, #category-filter li, #author-filter li").forEach((e=>{e.classList.remove("active")}));const t=document.querySelector(".search_input_infinte");t&&(t.value=""),e=1,n=!0,l.clear(),document.getElementById("infinite-scroll-container").innerHTML="",m(),y(e)}async function y(e){if(t||null!==r&&e>r)return;t=!0,f(!0);let c=`&before=${(new Date).getFullYear()}-01-01T00:00:00`;o&&(c+=`&after=${o}-01-01T00:00:00&before=${o}-12-31T23:59:59`),a&&(c+=`&categories=${a}`),i&&(c+=`&search=${i}`);const g=document.getElementById("postsPerPage"),y=g?g.getAttribute("data-value"):5;try{const t=await fetch(`${infiniteScrollData.rest_url}wp/v2/posts?page=${e}&per_page=${y}${c}&order=desc&orderby=date&_embed`,{headers:{"X-WP-Nonce":infiniteScrollData.nonce}});if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const o=await t.json(),a=o;if(a.sort(((e,t)=>{const n=new Date(e.date);return new Date(t.date)-n})),r=parseInt(t.headers.get("X-WP-TotalPages"),10)||r,o.length>0){const t=document.getElementById("infinite-scroll-container");if(!t)throw new Error("Container element not found!");for(const e of a){if(l.has(e.id))continue;let n=e._embedded?.["wp:term"]?.[0]?.[0].name;const r=document.createElement("div");r.classList.add("infinite_scroll_card"),r.style.backgroundColor=u,r.style.color=d,r.style.fontFamily=s,r.addEventListener("click",(()=>{window.location.href=e.link}));const o=new Date(e.date).getFullYear()<(new Date).getFullYear()?"<div class='achrive_post'><h4>ARCHIVE</h4></div>":"";r.innerHTML=`\n                    ${await h(e.featured_media)}\n                    ${o}\n                    <h4 class="infinite_scroll_card_byline" >${n}</h4>\n                    <h3 class="infinite_scroll_card_text" style="color: ${d};">${e.title.rendered}</h3>\n                    <h4 class="infinite_scroll_card_author" >by ${e._embedded.author[0].name} on ${E(e.date)}</h4>\n                    `,r.setAttribute("data-postid",e.id);const a=t.querySelectorAll("[data-postid]");Array.from(a).some((t=>t.getAttribute("data-postid")===e.id))||(t.appendChild(r),l.add(e.id))}let o=document.getElementById("sentinel");o||(o=document.createElement("div"),o.id="sentinel",t.appendChild(o)),w.observe(o),n=e<r}else n=!1;m()}catch(e){console.error("Error fetching posts:",e)}finally{!function(){const e=document.getElementById("infinite-scroll-container");if(!e)return;const t=new Set,n=e.querySelectorAll("[data-postid]"),r=document.querySelector(".cover_contain_archive").getAttribute("data-postid");n.forEach((e=>{const n=e.getAttribute("data-postid");t.has(n)||n==r?e.remove():t.add(n)}))}(),t=!1,f(!1)}}async function h(e){try{const t=await fetch(`${infiniteScrollData.rest_url}wp/v2/media/${e}`);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const n=await t.json();if(n&&n.source_url)return`<img class="infinite_scroll_card_image" src="${n.source_url}" alt="${n.alt_text||"Featured image"}" />`}catch(e){console.error("Error fetching featured image:",e)}return'<div class="no-image">&nbsp;</div>'}function E(e){if(!e)return"Invalid date";const t=new Date(e);if(isNaN(t.getTime()))return"Invalid date";const n=t.getFullYear(),r=t.toLocaleString("default",{month:"long"});return`${t.getDate()} ${r} ${n}`}const p=document.getElementById("toggle-filters"),v=document.getElementById("filter-container");if(p&&v){let e=!0;p.addEventListener("click",(function(){e=!e,v.style.display=e?"none":"grid",p.textContent=e?"SHOW FILTERS":"HIDE FILTERS"}))}const w=new IntersectionObserver(function(e){let t;return function(...n){t||(e.apply(this,n),t=!0,setTimeout((()=>t=!1),200))}}((r=>{r.forEach((r=>{r.isIntersecting&&n&&!t&&(e++,y(e))}))})),{rootMargin:"500px",threshold:1});let _=document.getElementById("sentinel");_||(_=document.createElement("div"),_.id="sentinel",document.getElementById("infinite-scroll-container").appendChild(_)),w.observe(_),async function(){await async function(){try{const e=await fetch(`${infiniteScrollData.rest_url}wp/v2/posts?per_page=1&order=asc&orderby=date`),t=await e.json(),n=t.length?new Date(t[0].date).getFullYear():2020,r=document.getElementById("year-filter");r.innerHTML="";const o=c.getAttribute("data-cutoffdate");let a;if(o){const e=new Date(o).getFullYear();a=Array.from({length:e-n+1},((e,t)=>n+t))}else{const e=(new Date).getFullYear();a=Array.from({length:e-n+1},((e,t)=>n+t))}a.reverse().forEach((e=>{const t=document.createElement("li");t.classList.add("filter_item"),t.textContent=e,t.dataset.value=e,r.appendChild(t)}))}catch(e){console.error("Error fetching years:",e)}}(),await async function(){try{const e=await fetch(`${infiniteScrollData.rest_url}wp/v2/categories`),t=await e.json(),n=document.getElementById("category-filter");n.innerHTML="",t.forEach((e=>{const t=document.createElement("li");t.classList.add("filter_item"),t.textContent=e.name,t.dataset.value=e.id,n.appendChild(t)}))}catch(e){console.error("Error fetching categories:",e)}}(),function(){document.querySelectorAll("#year-filter li").forEach((t=>{t.addEventListener("click",(()=>{o=t.dataset.value,a=selectedAuthor=i=null,e=1,n=!0,l.clear(),document.getElementById("infinite-scroll-container").innerHTML="",m(),y(e)}))})),document.querySelectorAll("#category-filter li").forEach((t=>{t.addEventListener("click",(()=>{a=t.dataset.value,o=selectedAuthor=i=null,e=1,n=!0,l.clear(),document.getElementById("infinite-scroll-container").innerHTML="",m(),y(e)}))}));const t=document.querySelector(".search_input_infinte");t.addEventListener("input",(()=>{i=t.value,o=a=selectedAuthor=null,e=1,n=!0,l.clear(),document.getElementById("infinite-scroll-container").innerHTML="",m(),y(e)}));const r=document.getElementById("clear-filters");r&&r.addEventListener("click",g)}()}(),y(e)}));